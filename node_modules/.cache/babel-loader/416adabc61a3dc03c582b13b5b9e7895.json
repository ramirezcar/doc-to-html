{"ast":null,"code":"\"use strict\";\n\nmodule.exports = function (Promise, tryConvertToPromise) {\n  var util = require(\"./util\");\n\n  var CancellationError = Promise.CancellationError;\n  var errorObj = util.errorObj;\n\n  function PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n  }\n\n  PassThroughHandlerContext.prototype.isFinallyHandler = function () {\n    return this.type === 0;\n  };\n\n  function FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n  }\n\n  FinallyHandlerCancelReaction.prototype._resultCancelled = function () {\n    checkCancel(this.finallyHandler);\n  };\n\n  function checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n      if (arguments.length > 1) {\n        ctx.cancelPromise._reject(reason);\n      } else {\n        ctx.cancelPromise._cancel();\n      }\n\n      ctx.cancelPromise = null;\n      return true;\n    }\n\n    return false;\n  }\n\n  function succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n  }\n\n  function fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n  }\n\n  function finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n      this.called = true;\n      var ret = this.isFinallyHandler() ? handler.call(promise._boundValue()) : handler.call(promise._boundValue(), reasonOrValue);\n\n      if (ret !== undefined) {\n        promise._setReturnedNonUndefined();\n\n        var maybePromise = tryConvertToPromise(ret, promise);\n\n        if (maybePromise instanceof Promise) {\n          if (this.cancelPromise != null) {\n            if (maybePromise._isCancelled()) {\n              var reason = new CancellationError(\"late cancellation observer\");\n\n              promise._attachExtraTrace(reason);\n\n              errorObj.e = reason;\n              return errorObj;\n            } else if (maybePromise.isPending()) {\n              maybePromise._attachCancellationCallback(new FinallyHandlerCancelReaction(this));\n            }\n          }\n\n          return maybePromise._then(succeed, fail, undefined, this, undefined);\n        }\n      }\n    }\n\n    if (promise.isRejected()) {\n      checkCancel(this);\n      errorObj.e = reasonOrValue;\n      return errorObj;\n    } else {\n      checkCancel(this);\n      return reasonOrValue;\n    }\n  }\n\n  Promise.prototype._passThrough = function (handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success, fail, undefined, new PassThroughHandlerContext(this, type, handler), undefined);\n  };\n\n  Promise.prototype.lastly = Promise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler, 0, finallyHandler, finallyHandler);\n  };\n\n  Promise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n  };\n\n  return PassThroughHandlerContext;\n};","map":{"version":3,"sources":["C:/Users/Carlos/Desktop/Coding/doc-to-html/node_modules/bluebird/js/release/finally.js"],"names":["module","exports","Promise","tryConvertToPromise","util","require","CancellationError","errorObj","PassThroughHandlerContext","promise","type","handler","called","cancelPromise","prototype","isFinallyHandler","FinallyHandlerCancelReaction","finallyHandler","_resultCancelled","checkCancel","ctx","reason","arguments","length","_reject","_cancel","succeed","call","_target","_settledValue","fail","e","reasonOrValue","ret","_boundValue","undefined","_setReturnedNonUndefined","maybePromise","_isCancelled","_attachExtraTrace","isPending","_attachCancellationCallback","_then","isRejected","_passThrough","success","then","lastly","tap"],"mappings":"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","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, tryConvertToPromise) {\nvar util = require(\"./util\");\nvar CancellationError = Promise.CancellationError;\nvar errorObj = util.errorObj;\n\nfunction PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n}\n\nPassThroughHandlerContext.prototype.isFinallyHandler = function() {\n    return this.type === 0;\n};\n\nfunction FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n}\n\nFinallyHandlerCancelReaction.prototype._resultCancelled = function() {\n    checkCancel(this.finallyHandler);\n};\n\nfunction checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n        if (arguments.length > 1) {\n            ctx.cancelPromise._reject(reason);\n        } else {\n            ctx.cancelPromise._cancel();\n        }\n        ctx.cancelPromise = null;\n        return true;\n    }\n    return false;\n}\n\nfunction succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n}\nfunction fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n}\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n        this.called = true;\n        var ret = this.isFinallyHandler()\n            ? handler.call(promise._boundValue())\n            : handler.call(promise._boundValue(), reasonOrValue);\n        if (ret !== undefined) {\n            promise._setReturnedNonUndefined();\n            var maybePromise = tryConvertToPromise(ret, promise);\n            if (maybePromise instanceof Promise) {\n                if (this.cancelPromise != null) {\n                    if (maybePromise._isCancelled()) {\n                        var reason =\n                            new CancellationError(\"late cancellation observer\");\n                        promise._attachExtraTrace(reason);\n                        errorObj.e = reason;\n                        return errorObj;\n                    } else if (maybePromise.isPending()) {\n                        maybePromise._attachCancellationCallback(\n                            new FinallyHandlerCancelReaction(this));\n                    }\n                }\n                return maybePromise._then(\n                    succeed, fail, undefined, this, undefined);\n            }\n        }\n    }\n\n    if (promise.isRejected()) {\n        checkCancel(this);\n        errorObj.e = reasonOrValue;\n        return errorObj;\n    } else {\n        checkCancel(this);\n        return reasonOrValue;\n    }\n}\n\nPromise.prototype._passThrough = function(handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success,\n                      fail,\n                      undefined,\n                      new PassThroughHandlerContext(this, type, handler),\n                      undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler,\n                             0,\n                             finallyHandler,\n                             finallyHandler);\n};\n\nPromise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n};\n\nreturn PassThroughHandlerContext;\n};\n"]},"metadata":{},"sourceType":"script"}