{"ast":null,"code":"var promises = require(\"../promises\");\n\nvar sax = require(\"sax\");\n\nvar _ = require(\"underscore\");\n\nvar nodes = require(\"./nodes\");\n\nvar Element = nodes.Element;\nexports.readString = readString;\n\nfunction readString(xmlString, namespaceMap) {\n  namespaceMap = namespaceMap || {};\n  var finished = false;\n  var parser = sax.parser(true, {\n    xmlns: true,\n    position: false\n  });\n  var rootElement = {\n    children: []\n  };\n  var currentElement = rootElement;\n  var stack = [];\n  var deferred = promises.defer();\n\n  parser.onopentag = function (node) {\n    var attributes = mapObject(node.attributes, function (attribute) {\n      return attribute.value;\n    }, mapName);\n    var element = new Element(mapName(node), attributes);\n    currentElement.children.push(element);\n    stack.push(currentElement);\n    currentElement = element;\n  };\n\n  function mapName(node) {\n    if (node.uri) {\n      var mappedPrefix = namespaceMap[node.uri];\n      var prefix;\n\n      if (mappedPrefix) {\n        prefix = mappedPrefix + \":\";\n      } else {\n        prefix = \"{\" + node.uri + \"}\";\n      }\n\n      return prefix + node.local;\n    } else {\n      return node.local;\n    }\n  }\n\n  parser.onclosetag = function (node) {\n    currentElement = stack.pop();\n  };\n\n  parser.ontext = function (text) {\n    if (currentElement !== rootElement) {\n      currentElement.children.push(nodes.text(text));\n    }\n  };\n\n  parser.onend = function () {\n    if (!finished) {\n      finished = true;\n      deferred.resolve(rootElement.children[0]);\n    }\n  };\n\n  parser.onerror = function (error) {\n    if (!finished) {\n      finished = true;\n      deferred.reject(error);\n    }\n  };\n\n  parser.write(xmlString).close();\n  return deferred.promise;\n}\n\nfunction mapObject(input, valueFunc, keyFunc) {\n  return _.reduce(input, function (result, value, key) {\n    var mappedKey = keyFunc(value, key, input);\n    result[mappedKey] = valueFunc(value, key, input);\n    return result;\n  }, {});\n}","map":{"version":3,"sources":["C:/Users/Carlos/Desktop/Coding/doc-to-html/node_modules/mammoth/lib/xml/reader.js"],"names":["promises","require","sax","_","nodes","Element","exports","readString","xmlString","namespaceMap","finished","parser","xmlns","position","rootElement","children","currentElement","stack","deferred","defer","onopentag","node","attributes","mapObject","attribute","value","mapName","element","push","uri","mappedPrefix","prefix","local","onclosetag","pop","ontext","text","onend","resolve","onerror","error","reject","write","close","promise","input","valueFunc","keyFunc","reduce","result","key","mappedKey"],"mappings":"AAAA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,aAAD,CAAtB;;AACA,IAAIC,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAjB;;AACA,IAAIE,CAAC,GAAGF,OAAO,CAAC,YAAD,CAAf;;AAEA,IAAIG,KAAK,GAAGH,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAII,OAAO,GAAGD,KAAK,CAACC,OAApB;AAEAC,OAAO,CAACC,UAAR,GAAqBA,UAArB;;AAEA,SAASA,UAAT,CAAoBC,SAApB,EAA+BC,YAA/B,EAA6C;AACzCA,EAAAA,YAAY,GAAGA,YAAY,IAAI,EAA/B;AAEA,MAAIC,QAAQ,GAAG,KAAf;AACA,MAAIC,MAAM,GAAGT,GAAG,CAACS,MAAJ,CAAW,IAAX,EAAiB;AAACC,IAAAA,KAAK,EAAE,IAAR;AAAcC,IAAAA,QAAQ,EAAE;AAAxB,GAAjB,CAAb;AAEA,MAAIC,WAAW,GAAG;AAACC,IAAAA,QAAQ,EAAE;AAAX,GAAlB;AACA,MAAIC,cAAc,GAAGF,WAArB;AACA,MAAIG,KAAK,GAAG,EAAZ;AAEA,MAAIC,QAAQ,GAAGlB,QAAQ,CAACmB,KAAT,EAAf;;AAEAR,EAAAA,MAAM,CAACS,SAAP,GAAmB,UAASC,IAAT,EAAe;AAC9B,QAAIC,UAAU,GAAGC,SAAS,CAACF,IAAI,CAACC,UAAN,EAAkB,UAASE,SAAT,EAAoB;AAC5D,aAAOA,SAAS,CAACC,KAAjB;AACH,KAFyB,EAEvBC,OAFuB,CAA1B;AAIA,QAAIC,OAAO,GAAG,IAAItB,OAAJ,CAAYqB,OAAO,CAACL,IAAD,CAAnB,EAA2BC,UAA3B,CAAd;AACAN,IAAAA,cAAc,CAACD,QAAf,CAAwBa,IAAxB,CAA6BD,OAA7B;AACAV,IAAAA,KAAK,CAACW,IAAN,CAAWZ,cAAX;AACAA,IAAAA,cAAc,GAAGW,OAAjB;AACH,GATD;;AAWA,WAASD,OAAT,CAAiBL,IAAjB,EAAuB;AACnB,QAAIA,IAAI,CAACQ,GAAT,EAAc;AACV,UAAIC,YAAY,GAAGrB,YAAY,CAACY,IAAI,CAACQ,GAAN,CAA/B;AACA,UAAIE,MAAJ;;AACA,UAAID,YAAJ,EAAkB;AACdC,QAAAA,MAAM,GAAGD,YAAY,GAAG,GAAxB;AACH,OAFD,MAEO;AACHC,QAAAA,MAAM,GAAG,MAAMV,IAAI,CAACQ,GAAX,GAAiB,GAA1B;AACH;;AACD,aAAOE,MAAM,GAAGV,IAAI,CAACW,KAArB;AACH,KATD,MASO;AACH,aAAOX,IAAI,CAACW,KAAZ;AACH;AACJ;;AAEDrB,EAAAA,MAAM,CAACsB,UAAP,GAAoB,UAASZ,IAAT,EAAe;AAC/BL,IAAAA,cAAc,GAAGC,KAAK,CAACiB,GAAN,EAAjB;AACH,GAFD;;AAIAvB,EAAAA,MAAM,CAACwB,MAAP,GAAgB,UAASC,IAAT,EAAe;AAC3B,QAAIpB,cAAc,KAAKF,WAAvB,EAAoC;AAChCE,MAAAA,cAAc,CAACD,QAAf,CAAwBa,IAAxB,CAA6BxB,KAAK,CAACgC,IAAN,CAAWA,IAAX,CAA7B;AACH;AACJ,GAJD;;AAMAzB,EAAAA,MAAM,CAAC0B,KAAP,GAAe,YAAW;AACtB,QAAI,CAAC3B,QAAL,EAAe;AACXA,MAAAA,QAAQ,GAAG,IAAX;AACAQ,MAAAA,QAAQ,CAACoB,OAAT,CAAiBxB,WAAW,CAACC,QAAZ,CAAqB,CAArB,CAAjB;AACH;AACJ,GALD;;AAOAJ,EAAAA,MAAM,CAAC4B,OAAP,GAAiB,UAASC,KAAT,EAAgB;AAC7B,QAAI,CAAC9B,QAAL,EAAe;AACXA,MAAAA,QAAQ,GAAG,IAAX;AACAQ,MAAAA,QAAQ,CAACuB,MAAT,CAAgBD,KAAhB;AACH;AACJ,GALD;;AAOA7B,EAAAA,MAAM,CAAC+B,KAAP,CAAalC,SAAb,EAAwBmC,KAAxB;AAEA,SAAOzB,QAAQ,CAAC0B,OAAhB;AACH;;AAED,SAASrB,SAAT,CAAmBsB,KAAnB,EAA0BC,SAA1B,EAAqCC,OAArC,EAA8C;AAC1C,SAAO5C,CAAC,CAAC6C,MAAF,CAASH,KAAT,EAAgB,UAASI,MAAT,EAAiBxB,KAAjB,EAAwByB,GAAxB,EAA6B;AAChD,QAAIC,SAAS,GAAGJ,OAAO,CAACtB,KAAD,EAAQyB,GAAR,EAAaL,KAAb,CAAvB;AACAI,IAAAA,MAAM,CAACE,SAAD,CAAN,GAAoBL,SAAS,CAACrB,KAAD,EAAQyB,GAAR,EAAaL,KAAb,CAA7B;AACA,WAAOI,MAAP;AACH,GAJM,EAIJ,EAJI,CAAP;AAKH","sourcesContent":["var promises = require(\"../promises\");\nvar sax = require(\"sax\");\nvar _ = require(\"underscore\");\n\nvar nodes = require(\"./nodes\");\nvar Element = nodes.Element;\n\nexports.readString = readString;\n\nfunction readString(xmlString, namespaceMap) {\n    namespaceMap = namespaceMap || {};\n    \n    var finished = false;\n    var parser = sax.parser(true, {xmlns: true, position: false});\n    \n    var rootElement = {children: []};\n    var currentElement = rootElement;\n    var stack = [];\n    \n    var deferred = promises.defer();\n    \n    parser.onopentag = function(node) {\n        var attributes = mapObject(node.attributes, function(attribute) {\n            return attribute.value;\n        }, mapName);\n        \n        var element = new Element(mapName(node), attributes);\n        currentElement.children.push(element);\n        stack.push(currentElement);\n        currentElement = element;\n    };\n    \n    function mapName(node) {\n        if (node.uri) {\n            var mappedPrefix = namespaceMap[node.uri];\n            var prefix;\n            if (mappedPrefix) {\n                prefix = mappedPrefix + \":\";\n            } else {\n                prefix = \"{\" + node.uri + \"}\";\n            }\n            return prefix + node.local;\n        } else {\n            return node.local;\n        }\n    }\n    \n    parser.onclosetag = function(node) {\n        currentElement = stack.pop();\n    };\n    \n    parser.ontext = function(text) {\n        if (currentElement !== rootElement) {\n            currentElement.children.push(nodes.text(text));\n        }\n    };\n    \n    parser.onend = function() {\n        if (!finished) {\n            finished = true;\n            deferred.resolve(rootElement.children[0]);\n        }\n    };\n    \n    parser.onerror = function(error) {\n        if (!finished) {\n            finished = true;\n            deferred.reject(error);\n        }\n    };\n    \n    parser.write(xmlString).close();\n    \n    return deferred.promise;\n}\n\nfunction mapObject(input, valueFunc, keyFunc) {\n    return _.reduce(input, function(result, value, key) {\n        var mappedKey = keyFunc(value, key, input);\n        result[mappedKey] = valueFunc(value, key, input);\n        return result;\n    }, {});\n}\n"]},"metadata":{},"sourceType":"script"}