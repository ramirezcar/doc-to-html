{"ast":null,"code":"exports.createBodyReader = createBodyReader;\nexports._readNumberingProperties = readNumberingProperties;\n\nvar dingbatToUnicode = require(\"dingbat-to-unicode\");\n\nvar _ = require(\"underscore\");\n\nvar documents = require(\"../documents\");\n\nvar Result = require(\"../results\").Result;\n\nvar warning = require(\"../results\").warning;\n\nvar uris = require(\"./uris\");\n\nfunction createBodyReader(options) {\n  return {\n    readXmlElement: function readXmlElement(element) {\n      return new BodyReader(options).readXmlElement(element);\n    },\n    readXmlElements: function readXmlElements(elements) {\n      return new BodyReader(options).readXmlElements(elements);\n    }\n  };\n}\n\nfunction BodyReader(options) {\n  var complexFieldStack = [];\n  var currentInstrText = [];\n  var relationships = options.relationships;\n  var contentTypes = options.contentTypes;\n  var docxFile = options.docxFile;\n  var files = options.files;\n  var numbering = options.numbering;\n  var styles = options.styles;\n\n  function readXmlElements(elements) {\n    var results = elements.map(readXmlElement);\n    return combineResults(results);\n  }\n\n  function readXmlElement(element) {\n    if (element.type === \"element\") {\n      var handler = xmlElementReaders[element.name];\n\n      if (handler) {\n        return handler(element);\n      } else if (!Object.prototype.hasOwnProperty.call(ignoreElements, element.name)) {\n        var message = warning(\"An unrecognised element was ignored: \" + element.name);\n        return emptyResultWithMessages([message]);\n      }\n    }\n\n    return emptyResult();\n  }\n\n  function readParagraphIndent(element) {\n    return {\n      start: element.attributes[\"w:start\"] || element.attributes[\"w:left\"],\n      end: element.attributes[\"w:end\"] || element.attributes[\"w:right\"],\n      firstLine: element.attributes[\"w:firstLine\"],\n      hanging: element.attributes[\"w:hanging\"]\n    };\n  }\n\n  function readRunProperties(element) {\n    return readRunStyle(element).map(function (style) {\n      var fontSizeString = element.firstOrEmpty(\"w:sz\").attributes[\"w:val\"]; // w:sz gives the font size in half points, so halve the value to get the size in points\n\n      var fontSize = /^[0-9]+$/.test(fontSizeString) ? parseInt(fontSizeString, 10) / 2 : null;\n      return {\n        type: \"runProperties\",\n        styleId: style.styleId,\n        styleName: style.name,\n        verticalAlignment: element.firstOrEmpty(\"w:vertAlign\").attributes[\"w:val\"],\n        font: element.firstOrEmpty(\"w:rFonts\").attributes[\"w:ascii\"],\n        fontSize: fontSize,\n        isBold: readBooleanElement(element.first(\"w:b\")),\n        isUnderline: readUnderline(element.first(\"w:u\")),\n        isItalic: readBooleanElement(element.first(\"w:i\")),\n        isStrikethrough: readBooleanElement(element.first(\"w:strike\")),\n        isAllCaps: readBooleanElement(element.first(\"w:caps\")),\n        isSmallCaps: readBooleanElement(element.first(\"w:smallCaps\"))\n      };\n    });\n  }\n\n  function readUnderline(element) {\n    if (element) {\n      var value = element.attributes[\"w:val\"];\n      return value !== \"false\" && value !== \"0\" && value !== \"none\";\n    } else {\n      return false;\n    }\n  }\n\n  function readBooleanElement(element) {\n    if (element) {\n      var value = element.attributes[\"w:val\"];\n      return value !== \"false\" && value !== \"0\";\n    } else {\n      return false;\n    }\n  }\n\n  function readParagraphStyle(element) {\n    return readStyle(element, \"w:pStyle\", \"Paragraph\", styles.findParagraphStyleById);\n  }\n\n  function readRunStyle(element) {\n    return readStyle(element, \"w:rStyle\", \"Run\", styles.findCharacterStyleById);\n  }\n\n  function readTableStyle(element) {\n    return readStyle(element, \"w:tblStyle\", \"Table\", styles.findTableStyleById);\n  }\n\n  function readStyle(element, styleTagName, styleType, findStyleById) {\n    var messages = [];\n    var styleElement = element.first(styleTagName);\n    var styleId = null;\n    var name = null;\n\n    if (styleElement) {\n      styleId = styleElement.attributes[\"w:val\"];\n\n      if (styleId) {\n        var style = findStyleById(styleId);\n\n        if (style) {\n          name = style.name;\n        } else {\n          messages.push(undefinedStyleWarning(styleType, styleId));\n        }\n      }\n    }\n\n    return elementResultWithMessages({\n      styleId: styleId,\n      name: name\n    }, messages);\n  }\n\n  var unknownComplexField = {\n    type: \"unknown\"\n  };\n\n  function readFldChar(element) {\n    var type = element.attributes[\"w:fldCharType\"];\n\n    if (type === \"begin\") {\n      complexFieldStack.push(unknownComplexField);\n      currentInstrText = [];\n    } else if (type === \"end\") {\n      complexFieldStack.pop();\n    } else if (type === \"separate\") {\n      var hyperlinkOptions = parseHyperlinkFieldCode(currentInstrText.join(''));\n      var complexField = hyperlinkOptions === null ? unknownComplexField : {\n        type: \"hyperlink\",\n        options: hyperlinkOptions\n      };\n      complexFieldStack.pop();\n      complexFieldStack.push(complexField);\n    }\n\n    return emptyResult();\n  }\n\n  function currentHyperlinkOptions() {\n    var topHyperlink = _.last(complexFieldStack.filter(function (complexField) {\n      return complexField.type === \"hyperlink\";\n    }));\n\n    return topHyperlink ? topHyperlink.options : null;\n  }\n\n  function parseHyperlinkFieldCode(code) {\n    var externalLinkResult = /\\s*HYPERLINK \"(.*)\"/.exec(code);\n\n    if (externalLinkResult) {\n      return {\n        href: externalLinkResult[1]\n      };\n    }\n\n    var internalLinkResult = /\\s*HYPERLINK\\s+\\\\l\\s+\"(.*)\"/.exec(code);\n\n    if (internalLinkResult) {\n      return {\n        anchor: internalLinkResult[1]\n      };\n    }\n\n    return null;\n  }\n\n  function readInstrText(element) {\n    currentInstrText.push(element.text());\n    return emptyResult();\n  }\n\n  function readSymbol(element) {\n    // See 17.3.3.30 sym (Symbol Character) of ECMA-376 4th edition Part 1\n    var font = element.attributes[\"w:font\"];\n    var char = element.attributes[\"w:char\"];\n    var unicodeCharacter = dingbatToUnicode.hex(font, char);\n\n    if (unicodeCharacter == null && /^F0..$/.test(char)) {\n      unicodeCharacter = dingbatToUnicode.hex(font, char.substring(2));\n    }\n\n    if (unicodeCharacter == null) {\n      return emptyResultWithMessages([warning(\"A w:sym element with an unsupported character was ignored: char \" + char + \" in font \" + font)]);\n    } else {\n      return elementResult(new documents.Text(unicodeCharacter.string));\n    }\n  }\n\n  function noteReferenceReader(noteType) {\n    return function (element) {\n      var noteId = element.attributes[\"w:id\"];\n      return elementResult(new documents.NoteReference({\n        noteType: noteType,\n        noteId: noteId\n      }));\n    };\n  }\n\n  function readCommentReference(element) {\n    return elementResult(documents.commentReference({\n      commentId: element.attributes[\"w:id\"]\n    }));\n  }\n\n  function readChildElements(element) {\n    return readXmlElements(element.children);\n  }\n\n  var xmlElementReaders = {\n    \"w:p\": function wP(element) {\n      return readXmlElements(element.children).map(function (children) {\n        var properties = _.find(children, isParagraphProperties);\n\n        return new documents.Paragraph(children.filter(negate(isParagraphProperties)), properties);\n      }).insertExtra();\n    },\n    \"w:pPr\": function wPPr(element) {\n      return readParagraphStyle(element).map(function (style) {\n        return {\n          type: \"paragraphProperties\",\n          styleId: style.styleId,\n          styleName: style.name,\n          alignment: element.firstOrEmpty(\"w:jc\").attributes[\"w:val\"],\n          numbering: readNumberingProperties(style.styleId, element.firstOrEmpty(\"w:numPr\"), numbering),\n          indent: readParagraphIndent(element.firstOrEmpty(\"w:ind\"))\n        };\n      });\n    },\n    \"w:r\": function wR(element) {\n      return readXmlElements(element.children).map(function (children) {\n        var properties = _.find(children, isRunProperties);\n\n        children = children.filter(negate(isRunProperties));\n        var hyperlinkOptions = currentHyperlinkOptions();\n\n        if (hyperlinkOptions !== null) {\n          children = [new documents.Hyperlink(children, hyperlinkOptions)];\n        }\n\n        return new documents.Run(children, properties);\n      });\n    },\n    \"w:rPr\": readRunProperties,\n    \"w:fldChar\": readFldChar,\n    \"w:instrText\": readInstrText,\n    \"w:t\": function wT(element) {\n      return elementResult(new documents.Text(element.text()));\n    },\n    \"w:tab\": function wTab(element) {\n      return elementResult(new documents.Tab());\n    },\n    \"w:noBreakHyphen\": function wNoBreakHyphen() {\n      return elementResult(new documents.Text(\"\\u2011\"));\n    },\n    \"w:softHyphen\": function wSoftHyphen(element) {\n      return elementResult(new documents.Text(\"\\xAD\"));\n    },\n    \"w:sym\": readSymbol,\n    \"w:hyperlink\": function wHyperlink(element) {\n      var relationshipId = element.attributes[\"r:id\"];\n      var anchor = element.attributes[\"w:anchor\"];\n      return readXmlElements(element.children).map(function (children) {\n        function create(options) {\n          var targetFrame = element.attributes[\"w:tgtFrame\"] || null;\n          return new documents.Hyperlink(children, _.extend({\n            targetFrame: targetFrame\n          }, options));\n        }\n\n        if (relationshipId) {\n          var href = relationships.findTargetByRelationshipId(relationshipId);\n\n          if (anchor) {\n            href = uris.replaceFragment(href, anchor);\n          }\n\n          return create({\n            href: href\n          });\n        } else if (anchor) {\n          return create({\n            anchor: anchor\n          });\n        } else {\n          return children;\n        }\n      });\n    },\n    \"w:tbl\": readTable,\n    \"w:tr\": readTableRow,\n    \"w:tc\": readTableCell,\n    \"w:footnoteReference\": noteReferenceReader(\"footnote\"),\n    \"w:endnoteReference\": noteReferenceReader(\"endnote\"),\n    \"w:commentReference\": readCommentReference,\n    \"w:br\": function wBr(element) {\n      var breakType = element.attributes[\"w:type\"];\n\n      if (breakType == null || breakType === \"textWrapping\") {\n        return elementResult(documents.lineBreak);\n      } else if (breakType === \"page\") {\n        return elementResult(documents.pageBreak);\n      } else if (breakType === \"column\") {\n        return elementResult(documents.columnBreak);\n      } else {\n        return emptyResultWithMessages([warning(\"Unsupported break type: \" + breakType)]);\n      }\n    },\n    \"w:bookmarkStart\": function wBookmarkStart(element) {\n      var name = element.attributes[\"w:name\"];\n\n      if (name === \"_GoBack\") {\n        return emptyResult();\n      } else {\n        return elementResult(new documents.BookmarkStart({\n          name: name\n        }));\n      }\n    },\n    \"mc:AlternateContent\": function mcAlternateContent(element) {\n      return readChildElements(element.first(\"mc:Fallback\"));\n    },\n    \"w:sdt\": function wSdt(element) {\n      return readXmlElements(element.firstOrEmpty(\"w:sdtContent\").children);\n    },\n    \"w:ins\": readChildElements,\n    \"w:object\": readChildElements,\n    \"w:smartTag\": readChildElements,\n    \"w:drawing\": readChildElements,\n    \"w:pict\": function wPict(element) {\n      return readChildElements(element).toExtra();\n    },\n    \"v:roundrect\": readChildElements,\n    \"v:shape\": readChildElements,\n    \"v:textbox\": readChildElements,\n    \"w:txbxContent\": readChildElements,\n    \"wp:inline\": readDrawingElement,\n    \"wp:anchor\": readDrawingElement,\n    \"v:imagedata\": readImageData,\n    \"v:group\": readChildElements,\n    \"v:rect\": readChildElements\n  };\n  return {\n    readXmlElement: readXmlElement,\n    readXmlElements: readXmlElements\n  };\n\n  function readTable(element) {\n    var propertiesResult = readTableProperties(element.firstOrEmpty(\"w:tblPr\"));\n    return readXmlElements(element.children).flatMap(calculateRowSpans).flatMap(function (children) {\n      return propertiesResult.map(function (properties) {\n        return documents.Table(children, properties);\n      });\n    });\n  }\n\n  function readTableProperties(element) {\n    return readTableStyle(element).map(function (style) {\n      return {\n        styleId: style.styleId,\n        styleName: style.name\n      };\n    });\n  }\n\n  function readTableRow(element) {\n    var properties = element.firstOrEmpty(\"w:trPr\");\n    var isHeader = !!properties.first(\"w:tblHeader\");\n    return readXmlElements(element.children).map(function (children) {\n      return documents.TableRow(children, {\n        isHeader: isHeader\n      });\n    });\n  }\n\n  function readTableCell(element) {\n    return readXmlElements(element.children).map(function (children) {\n      var properties = element.firstOrEmpty(\"w:tcPr\");\n      var gridSpan = properties.firstOrEmpty(\"w:gridSpan\").attributes[\"w:val\"];\n      var colSpan = gridSpan ? parseInt(gridSpan, 10) : 1;\n      var cell = documents.TableCell(children, {\n        colSpan: colSpan\n      });\n      cell._vMerge = readVMerge(properties);\n      return cell;\n    });\n  }\n\n  function readVMerge(properties) {\n    var element = properties.first(\"w:vMerge\");\n\n    if (element) {\n      var val = element.attributes[\"w:val\"];\n      return val === \"continue\" || !val;\n    } else {\n      return null;\n    }\n  }\n\n  function calculateRowSpans(rows) {\n    var unexpectedNonRows = _.any(rows, function (row) {\n      return row.type !== documents.types.tableRow;\n    });\n\n    if (unexpectedNonRows) {\n      return elementResultWithMessages(rows, [warning(\"unexpected non-row element in table, cell merging may be incorrect\")]);\n    }\n\n    var unexpectedNonCells = _.any(rows, function (row) {\n      return _.any(row.children, function (cell) {\n        return cell.type !== documents.types.tableCell;\n      });\n    });\n\n    if (unexpectedNonCells) {\n      return elementResultWithMessages(rows, [warning(\"unexpected non-cell element in table row, cell merging may be incorrect\")]);\n    }\n\n    var columns = {};\n    rows.forEach(function (row) {\n      var cellIndex = 0;\n      row.children.forEach(function (cell) {\n        if (cell._vMerge && columns[cellIndex]) {\n          columns[cellIndex].rowSpan++;\n        } else {\n          columns[cellIndex] = cell;\n          cell._vMerge = false;\n        }\n\n        cellIndex += cell.colSpan;\n      });\n    });\n    rows.forEach(function (row) {\n      row.children = row.children.filter(function (cell) {\n        return !cell._vMerge;\n      });\n      row.children.forEach(function (cell) {\n        delete cell._vMerge;\n      });\n    });\n    return elementResult(rows);\n  }\n\n  function readDrawingElement(element) {\n    var blips = element.getElementsByTagName(\"a:graphic\").getElementsByTagName(\"a:graphicData\").getElementsByTagName(\"pic:pic\").getElementsByTagName(\"pic:blipFill\").getElementsByTagName(\"a:blip\");\n    return combineResults(blips.map(readBlip.bind(null, element)));\n  }\n\n  function readBlip(element, blip) {\n    var properties = element.first(\"wp:docPr\").attributes;\n    var altText = isBlank(properties.descr) ? properties.title : properties.descr;\n    return readImage(findBlipImageFile(blip), altText);\n  }\n\n  function isBlank(value) {\n    return value == null || /^\\s*$/.test(value);\n  }\n\n  function findBlipImageFile(blip) {\n    var embedRelationshipId = blip.attributes[\"r:embed\"];\n    var linkRelationshipId = blip.attributes[\"r:link\"];\n\n    if (embedRelationshipId) {\n      return findEmbeddedImageFile(embedRelationshipId);\n    } else {\n      var imagePath = relationships.findTargetByRelationshipId(linkRelationshipId);\n      return {\n        path: imagePath,\n        read: files.read.bind(files, imagePath)\n      };\n    }\n  }\n\n  function readImageData(element) {\n    var relationshipId = element.attributes['r:id'];\n\n    if (relationshipId) {\n      return readImage(findEmbeddedImageFile(relationshipId), element.attributes[\"o:title\"]);\n    } else {\n      return emptyResultWithMessages([warning(\"A v:imagedata element without a relationship ID was ignored\")]);\n    }\n  }\n\n  function findEmbeddedImageFile(relationshipId) {\n    var path = uris.uriToZipEntryName(\"word\", relationships.findTargetByRelationshipId(relationshipId));\n    return {\n      path: path,\n      read: docxFile.read.bind(docxFile, path)\n    };\n  }\n\n  function readImage(imageFile, altText) {\n    var contentType = contentTypes.findContentType(imageFile.path);\n    var image = documents.Image({\n      readImage: imageFile.read,\n      altText: altText,\n      contentType: contentType\n    });\n    var warnings = supportedImageTypes[contentType] ? [] : warning(\"Image of type \" + contentType + \" is unlikely to display in web browsers\");\n    return elementResultWithMessages(image, warnings);\n  }\n\n  function undefinedStyleWarning(type, styleId) {\n    return warning(type + \" style with ID \" + styleId + \" was referenced but not defined in the document\");\n  }\n}\n\nfunction readNumberingProperties(styleId, element, numbering) {\n  if (styleId != null) {\n    var levelByStyleId = numbering.findLevelByParagraphStyleId(styleId);\n\n    if (levelByStyleId != null) {\n      return levelByStyleId;\n    }\n  }\n\n  var level = element.firstOrEmpty(\"w:ilvl\").attributes[\"w:val\"];\n  var numId = element.firstOrEmpty(\"w:numId\").attributes[\"w:val\"];\n\n  if (level === undefined || numId === undefined) {\n    return null;\n  } else {\n    return numbering.findLevel(numId, level);\n  }\n}\n\nvar supportedImageTypes = {\n  \"image/png\": true,\n  \"image/gif\": true,\n  \"image/jpeg\": true,\n  \"image/svg+xml\": true,\n  \"image/tiff\": true\n};\nvar ignoreElements = {\n  \"office-word:wrap\": true,\n  \"v:shadow\": true,\n  \"v:shapetype\": true,\n  \"w:annotationRef\": true,\n  \"w:bookmarkEnd\": true,\n  \"w:sectPr\": true,\n  \"w:proofErr\": true,\n  \"w:lastRenderedPageBreak\": true,\n  \"w:commentRangeStart\": true,\n  \"w:commentRangeEnd\": true,\n  \"w:del\": true,\n  \"w:footnoteRef\": true,\n  \"w:endnoteRef\": true,\n  \"w:tblPr\": true,\n  \"w:tblGrid\": true,\n  \"w:trPr\": true,\n  \"w:tcPr\": true\n};\n\nfunction isParagraphProperties(element) {\n  return element.type === \"paragraphProperties\";\n}\n\nfunction isRunProperties(element) {\n  return element.type === \"runProperties\";\n}\n\nfunction negate(predicate) {\n  return function (value) {\n    return !predicate(value);\n  };\n}\n\nfunction emptyResultWithMessages(messages) {\n  return new ReadResult(null, null, messages);\n}\n\nfunction emptyResult() {\n  return new ReadResult(null);\n}\n\nfunction elementResult(element) {\n  return new ReadResult(element);\n}\n\nfunction elementResultWithMessages(element, messages) {\n  return new ReadResult(element, null, messages);\n}\n\nfunction ReadResult(element, extra, messages) {\n  this.value = element || [];\n  this.extra = extra;\n  this._result = new Result({\n    element: this.value,\n    extra: extra\n  }, messages);\n  this.messages = this._result.messages;\n}\n\nReadResult.prototype.toExtra = function () {\n  return new ReadResult(null, joinElements(this.extra, this.value), this.messages);\n};\n\nReadResult.prototype.insertExtra = function () {\n  var extra = this.extra;\n\n  if (extra && extra.length) {\n    return new ReadResult(joinElements(this.value, extra), null, this.messages);\n  } else {\n    return this;\n  }\n};\n\nReadResult.prototype.map = function (func) {\n  var result = this._result.map(function (value) {\n    return func(value.element);\n  });\n\n  return new ReadResult(result.value, this.extra, result.messages);\n};\n\nReadResult.prototype.flatMap = function (func) {\n  var result = this._result.flatMap(function (value) {\n    return func(value.element)._result;\n  });\n\n  return new ReadResult(result.value.element, joinElements(this.extra, result.value.extra), result.messages);\n};\n\nfunction combineResults(results) {\n  var result = Result.combine(_.pluck(results, \"_result\"));\n  return new ReadResult(_.flatten(_.pluck(result.value, \"element\")), _.filter(_.flatten(_.pluck(result.value, \"extra\")), identity), result.messages);\n}\n\nfunction joinElements(first, second) {\n  return _.flatten([first, second]);\n}\n\nfunction identity(value) {\n  return value;\n}","map":{"version":3,"sources":["C:/Users/Carlos/Desktop/Coding/doc-to-html/node_modules/mammoth/lib/docx/body-reader.js"],"names":["exports","createBodyReader","_readNumberingProperties","readNumberingProperties","dingbatToUnicode","require","_","documents","Result","warning","uris","options","readXmlElement","element","BodyReader","readXmlElements","elements","complexFieldStack","currentInstrText","relationships","contentTypes","docxFile","files","numbering","styles","results","map","combineResults","type","handler","xmlElementReaders","name","Object","prototype","hasOwnProperty","call","ignoreElements","message","emptyResultWithMessages","emptyResult","readParagraphIndent","start","attributes","end","firstLine","hanging","readRunProperties","readRunStyle","style","fontSizeString","firstOrEmpty","fontSize","test","parseInt","styleId","styleName","verticalAlignment","font","isBold","readBooleanElement","first","isUnderline","readUnderline","isItalic","isStrikethrough","isAllCaps","isSmallCaps","value","readParagraphStyle","readStyle","findParagraphStyleById","findCharacterStyleById","readTableStyle","findTableStyleById","styleTagName","styleType","findStyleById","messages","styleElement","push","undefinedStyleWarning","elementResultWithMessages","unknownComplexField","readFldChar","pop","hyperlinkOptions","parseHyperlinkFieldCode","join","complexField","currentHyperlinkOptions","topHyperlink","last","filter","code","externalLinkResult","exec","href","internalLinkResult","anchor","readInstrText","text","readSymbol","char","unicodeCharacter","hex","substring","elementResult","Text","string","noteReferenceReader","noteType","noteId","NoteReference","readCommentReference","commentReference","commentId","readChildElements","children","properties","find","isParagraphProperties","Paragraph","negate","insertExtra","alignment","indent","isRunProperties","Hyperlink","Run","Tab","relationshipId","create","targetFrame","extend","findTargetByRelationshipId","replaceFragment","readTable","readTableRow","readTableCell","breakType","lineBreak","pageBreak","columnBreak","BookmarkStart","toExtra","readDrawingElement","readImageData","propertiesResult","readTableProperties","flatMap","calculateRowSpans","Table","isHeader","TableRow","gridSpan","colSpan","cell","TableCell","_vMerge","readVMerge","val","rows","unexpectedNonRows","any","row","types","tableRow","unexpectedNonCells","tableCell","columns","forEach","cellIndex","rowSpan","blips","getElementsByTagName","readBlip","bind","blip","altText","isBlank","descr","title","readImage","findBlipImageFile","embedRelationshipId","linkRelationshipId","findEmbeddedImageFile","imagePath","path","read","uriToZipEntryName","imageFile","contentType","findContentType","image","Image","warnings","supportedImageTypes","levelByStyleId","findLevelByParagraphStyleId","level","numId","undefined","findLevel","predicate","ReadResult","extra","_result","joinElements","length","func","result","combine","pluck","flatten","identity","second"],"mappings":"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","sourcesContent":["exports.createBodyReader = createBodyReader;\nexports._readNumberingProperties = readNumberingProperties;\n\nvar dingbatToUnicode = require(\"dingbat-to-unicode\");\nvar _ = require(\"underscore\");\n\nvar documents = require(\"../documents\");\nvar Result = require(\"../results\").Result;\nvar warning = require(\"../results\").warning;\nvar uris = require(\"./uris\");\n\nfunction createBodyReader(options) {\n    return {\n        readXmlElement: function(element) {\n            return new BodyReader(options).readXmlElement(element);\n        },\n        readXmlElements: function(elements) {\n            return new BodyReader(options).readXmlElements(elements);\n        }\n    };\n}\n\nfunction BodyReader(options) {\n    var complexFieldStack = [];\n    var currentInstrText = [];\n    var relationships = options.relationships;\n    var contentTypes = options.contentTypes;\n    var docxFile = options.docxFile;\n    var files = options.files;\n    var numbering = options.numbering;\n    var styles = options.styles;\n\n    function readXmlElements(elements) {\n        var results = elements.map(readXmlElement);\n        return combineResults(results);\n    }\n\n    function readXmlElement(element) {\n        if (element.type === \"element\") {\n            var handler = xmlElementReaders[element.name];\n            if (handler) {\n                return handler(element);\n            } else if (!Object.prototype.hasOwnProperty.call(ignoreElements, element.name)) {\n                var message = warning(\"An unrecognised element was ignored: \" + element.name);\n                return emptyResultWithMessages([message]);\n            }\n        }\n        return emptyResult();\n    }\n\n    function readParagraphIndent(element) {\n        return {\n            start: element.attributes[\"w:start\"] || element.attributes[\"w:left\"],\n            end: element.attributes[\"w:end\"] || element.attributes[\"w:right\"],\n            firstLine: element.attributes[\"w:firstLine\"],\n            hanging: element.attributes[\"w:hanging\"]\n        };\n    }\n\n    function readRunProperties(element) {\n        return readRunStyle(element).map(function(style) {\n            var fontSizeString = element.firstOrEmpty(\"w:sz\").attributes[\"w:val\"];\n            // w:sz gives the font size in half points, so halve the value to get the size in points\n            var fontSize = /^[0-9]+$/.test(fontSizeString) ? parseInt(fontSizeString, 10) / 2 : null;\n\n            return {\n                type: \"runProperties\",\n                styleId: style.styleId,\n                styleName: style.name,\n                verticalAlignment: element.firstOrEmpty(\"w:vertAlign\").attributes[\"w:val\"],\n                font: element.firstOrEmpty(\"w:rFonts\").attributes[\"w:ascii\"],\n                fontSize: fontSize,\n                isBold: readBooleanElement(element.first(\"w:b\")),\n                isUnderline: readUnderline(element.first(\"w:u\")),\n                isItalic: readBooleanElement(element.first(\"w:i\")),\n                isStrikethrough: readBooleanElement(element.first(\"w:strike\")),\n                isAllCaps: readBooleanElement(element.first(\"w:caps\")),\n                isSmallCaps: readBooleanElement(element.first(\"w:smallCaps\"))\n            };\n        });\n    }\n\n    function readUnderline(element) {\n        if (element) {\n            var value = element.attributes[\"w:val\"];\n            return value !== \"false\" && value !== \"0\" && value !== \"none\";\n        } else {\n            return false;\n        }\n    }\n\n    function readBooleanElement(element) {\n        if (element) {\n            var value = element.attributes[\"w:val\"];\n            return value !== \"false\" && value !== \"0\";\n        } else {\n            return false;\n        }\n    }\n\n    function readParagraphStyle(element) {\n        return readStyle(element, \"w:pStyle\", \"Paragraph\", styles.findParagraphStyleById);\n    }\n\n    function readRunStyle(element) {\n        return readStyle(element, \"w:rStyle\", \"Run\", styles.findCharacterStyleById);\n    }\n\n    function readTableStyle(element) {\n        return readStyle(element, \"w:tblStyle\", \"Table\", styles.findTableStyleById);\n    }\n\n    function readStyle(element, styleTagName, styleType, findStyleById) {\n        var messages = [];\n        var styleElement = element.first(styleTagName);\n        var styleId = null;\n        var name = null;\n        if (styleElement) {\n            styleId = styleElement.attributes[\"w:val\"];\n            if (styleId) {\n                var style = findStyleById(styleId);\n                if (style) {\n                    name = style.name;\n                } else {\n                    messages.push(undefinedStyleWarning(styleType, styleId));\n                }\n            }\n        }\n        return elementResultWithMessages({styleId: styleId, name: name}, messages);\n    }\n\n    var unknownComplexField = {type: \"unknown\"};\n\n    function readFldChar(element) {\n        var type = element.attributes[\"w:fldCharType\"];\n        if (type === \"begin\") {\n            complexFieldStack.push(unknownComplexField);\n            currentInstrText = [];\n        } else if (type === \"end\") {\n            complexFieldStack.pop();\n        } else if (type === \"separate\") {\n            var hyperlinkOptions = parseHyperlinkFieldCode(currentInstrText.join(''));\n            var complexField = hyperlinkOptions === null ? unknownComplexField : {type: \"hyperlink\", options: hyperlinkOptions};\n            complexFieldStack.pop();\n            complexFieldStack.push(complexField);\n        }\n        return emptyResult();\n    }\n\n    function currentHyperlinkOptions() {\n        var topHyperlink = _.last(complexFieldStack.filter(function(complexField) {\n            return complexField.type === \"hyperlink\";\n        }));\n        return topHyperlink ? topHyperlink.options : null;\n    }\n\n    function parseHyperlinkFieldCode(code) {\n        var externalLinkResult = /\\s*HYPERLINK \"(.*)\"/.exec(code);\n        if (externalLinkResult) {\n            return {href: externalLinkResult[1]};\n        }\n\n        var internalLinkResult = /\\s*HYPERLINK\\s+\\\\l\\s+\"(.*)\"/.exec(code);\n        if (internalLinkResult) {\n            return {anchor: internalLinkResult[1]};\n        }\n\n        return null;\n    }\n\n    function readInstrText(element) {\n        currentInstrText.push(element.text());\n        return emptyResult();\n    }\n\n    function readSymbol(element) {\n        // See 17.3.3.30 sym (Symbol Character) of ECMA-376 4th edition Part 1\n        var font = element.attributes[\"w:font\"];\n        var char = element.attributes[\"w:char\"];\n        var unicodeCharacter = dingbatToUnicode.hex(font, char);\n        if (unicodeCharacter == null && /^F0..$/.test(char)) {\n            unicodeCharacter = dingbatToUnicode.hex(font, char.substring(2));\n        }\n\n        if (unicodeCharacter == null) {\n            return emptyResultWithMessages([warning(\n                \"A w:sym element with an unsupported character was ignored: char \" +  char + \" in font \" + font\n            )]);\n        } else {\n            return elementResult(new documents.Text(unicodeCharacter.string));\n        }\n    }\n\n    function noteReferenceReader(noteType) {\n        return function(element) {\n            var noteId = element.attributes[\"w:id\"];\n            return elementResult(new documents.NoteReference({\n                noteType: noteType,\n                noteId: noteId\n            }));\n        };\n    }\n\n    function readCommentReference(element) {\n        return elementResult(documents.commentReference({\n            commentId: element.attributes[\"w:id\"]\n        }));\n    }\n\n    function readChildElements(element) {\n        return readXmlElements(element.children);\n    }\n\n    var xmlElementReaders = {\n        \"w:p\": function(element) {\n            return readXmlElements(element.children)\n                .map(function(children) {\n                    var properties = _.find(children, isParagraphProperties);\n                    return new documents.Paragraph(\n                        children.filter(negate(isParagraphProperties)),\n                        properties\n                    );\n                })\n                .insertExtra();\n        },\n        \"w:pPr\": function(element) {\n            return readParagraphStyle(element).map(function(style) {\n                return {\n                    type: \"paragraphProperties\",\n                    styleId: style.styleId,\n                    styleName: style.name,\n                    alignment: element.firstOrEmpty(\"w:jc\").attributes[\"w:val\"],\n                    numbering: readNumberingProperties(style.styleId, element.firstOrEmpty(\"w:numPr\"), numbering),\n                    indent: readParagraphIndent(element.firstOrEmpty(\"w:ind\"))\n                };\n            });\n        },\n        \"w:r\": function(element) {\n            return readXmlElements(element.children)\n                .map(function(children) {\n                    var properties = _.find(children, isRunProperties);\n                    children = children.filter(negate(isRunProperties));\n\n                    var hyperlinkOptions = currentHyperlinkOptions();\n                    if (hyperlinkOptions !== null) {\n                        children = [new documents.Hyperlink(children, hyperlinkOptions)];\n                    }\n\n                    return new documents.Run(children, properties);\n                });\n        },\n        \"w:rPr\": readRunProperties,\n        \"w:fldChar\": readFldChar,\n        \"w:instrText\": readInstrText,\n        \"w:t\": function(element) {\n            return elementResult(new documents.Text(element.text()));\n        },\n        \"w:tab\": function(element) {\n            return elementResult(new documents.Tab());\n        },\n        \"w:noBreakHyphen\": function() {\n            return elementResult(new documents.Text(\"\\u2011\"));\n        },\n        \"w:softHyphen\": function(element) {\n            return elementResult(new documents.Text(\"\\u00AD\"));\n        },\n        \"w:sym\": readSymbol,\n        \"w:hyperlink\": function(element) {\n            var relationshipId = element.attributes[\"r:id\"];\n            var anchor = element.attributes[\"w:anchor\"];\n            return readXmlElements(element.children).map(function(children) {\n                function create(options) {\n                    var targetFrame = element.attributes[\"w:tgtFrame\"] || null;\n\n                    return new documents.Hyperlink(\n                        children,\n                        _.extend({targetFrame: targetFrame}, options)\n                    );\n                }\n\n                if (relationshipId) {\n                    var href = relationships.findTargetByRelationshipId(relationshipId);\n                    if (anchor) {\n                        href = uris.replaceFragment(href, anchor);\n                    }\n                    return create({href: href});\n                } else if (anchor) {\n                    return create({anchor: anchor});\n                } else {\n                    return children;\n                }\n            });\n        },\n        \"w:tbl\": readTable,\n        \"w:tr\": readTableRow,\n        \"w:tc\": readTableCell,\n        \"w:footnoteReference\": noteReferenceReader(\"footnote\"),\n        \"w:endnoteReference\": noteReferenceReader(\"endnote\"),\n        \"w:commentReference\": readCommentReference,\n        \"w:br\": function(element) {\n            var breakType = element.attributes[\"w:type\"];\n            if (breakType == null || breakType === \"textWrapping\") {\n                return elementResult(documents.lineBreak);\n            } else if (breakType === \"page\") {\n                return elementResult(documents.pageBreak);\n            } else if (breakType === \"column\") {\n                return elementResult(documents.columnBreak);\n            } else {\n                return emptyResultWithMessages([warning(\"Unsupported break type: \" + breakType)]);\n            }\n        },\n        \"w:bookmarkStart\": function(element){\n            var name = element.attributes[\"w:name\"];\n            if (name === \"_GoBack\") {\n                return emptyResult();\n            } else {\n                return elementResult(new documents.BookmarkStart({name: name}));\n            }\n        },\n\n        \"mc:AlternateContent\": function(element) {\n            return readChildElements(element.first(\"mc:Fallback\"));\n        },\n\n        \"w:sdt\": function(element) {\n            return readXmlElements(element.firstOrEmpty(\"w:sdtContent\").children);\n        },\n\n        \"w:ins\": readChildElements,\n        \"w:object\": readChildElements,\n        \"w:smartTag\": readChildElements,\n        \"w:drawing\": readChildElements,\n        \"w:pict\": function(element) {\n            return readChildElements(element).toExtra();\n        },\n        \"v:roundrect\": readChildElements,\n        \"v:shape\": readChildElements,\n        \"v:textbox\": readChildElements,\n        \"w:txbxContent\": readChildElements,\n        \"wp:inline\": readDrawingElement,\n        \"wp:anchor\": readDrawingElement,\n        \"v:imagedata\": readImageData,\n        \"v:group\": readChildElements,\n        \"v:rect\": readChildElements\n    };\n\n    return {\n        readXmlElement: readXmlElement,\n        readXmlElements: readXmlElements\n    };\n\n\n    function readTable(element) {\n        var propertiesResult = readTableProperties(element.firstOrEmpty(\"w:tblPr\"));\n        return readXmlElements(element.children)\n            .flatMap(calculateRowSpans)\n            .flatMap(function(children) {\n                return propertiesResult.map(function(properties) {\n                    return documents.Table(children, properties);\n                });\n            });\n    }\n\n    function readTableProperties(element) {\n        return readTableStyle(element).map(function(style) {\n            return {\n                styleId: style.styleId,\n                styleName: style.name\n            };\n        });\n    }\n\n    function readTableRow(element) {\n        var properties = element.firstOrEmpty(\"w:trPr\");\n        var isHeader = !!properties.first(\"w:tblHeader\");\n        return readXmlElements(element.children).map(function(children) {\n            return documents.TableRow(children, {isHeader: isHeader});\n        });\n    }\n\n    function readTableCell(element) {\n        return readXmlElements(element.children).map(function(children) {\n            var properties = element.firstOrEmpty(\"w:tcPr\");\n\n            var gridSpan = properties.firstOrEmpty(\"w:gridSpan\").attributes[\"w:val\"];\n            var colSpan = gridSpan ? parseInt(gridSpan, 10) : 1;\n\n            var cell = documents.TableCell(children, {colSpan: colSpan});\n            cell._vMerge = readVMerge(properties);\n            return cell;\n        });\n    }\n\n    function readVMerge(properties) {\n        var element = properties.first(\"w:vMerge\");\n        if (element) {\n            var val = element.attributes[\"w:val\"];\n            return val === \"continue\" || !val;\n        } else {\n            return null;\n        }\n    }\n\n    function calculateRowSpans(rows) {\n        var unexpectedNonRows = _.any(rows, function(row) {\n            return row.type !== documents.types.tableRow;\n        });\n        if (unexpectedNonRows) {\n            return elementResultWithMessages(rows, [warning(\n                \"unexpected non-row element in table, cell merging may be incorrect\"\n            )]);\n        }\n        var unexpectedNonCells = _.any(rows, function(row) {\n            return _.any(row.children, function(cell) {\n                return cell.type !== documents.types.tableCell;\n            });\n        });\n        if (unexpectedNonCells) {\n            return elementResultWithMessages(rows, [warning(\n                \"unexpected non-cell element in table row, cell merging may be incorrect\"\n            )]);\n        }\n\n        var columns = {};\n\n        rows.forEach(function(row) {\n            var cellIndex = 0;\n            row.children.forEach(function(cell) {\n                if (cell._vMerge && columns[cellIndex]) {\n                    columns[cellIndex].rowSpan++;\n                } else {\n                    columns[cellIndex] = cell;\n                    cell._vMerge = false;\n                }\n                cellIndex += cell.colSpan;\n            });\n        });\n\n        rows.forEach(function(row) {\n            row.children = row.children.filter(function(cell) {\n                return !cell._vMerge;\n            });\n            row.children.forEach(function(cell) {\n                delete cell._vMerge;\n            });\n        });\n\n        return elementResult(rows);\n    }\n\n    function readDrawingElement(element) {\n        var blips = element\n            .getElementsByTagName(\"a:graphic\")\n            .getElementsByTagName(\"a:graphicData\")\n            .getElementsByTagName(\"pic:pic\")\n            .getElementsByTagName(\"pic:blipFill\")\n            .getElementsByTagName(\"a:blip\");\n\n        return combineResults(blips.map(readBlip.bind(null, element)));\n    }\n\n    function readBlip(element, blip) {\n        var properties = element.first(\"wp:docPr\").attributes;\n        var altText = isBlank(properties.descr) ? properties.title : properties.descr;\n        return readImage(findBlipImageFile(blip), altText);\n    }\n\n    function isBlank(value) {\n        return value == null || /^\\s*$/.test(value);\n    }\n\n    function findBlipImageFile(blip) {\n        var embedRelationshipId = blip.attributes[\"r:embed\"];\n        var linkRelationshipId = blip.attributes[\"r:link\"];\n        if (embedRelationshipId) {\n            return findEmbeddedImageFile(embedRelationshipId);\n        } else {\n            var imagePath = relationships.findTargetByRelationshipId(linkRelationshipId);\n            return {\n                path: imagePath,\n                read: files.read.bind(files, imagePath)\n            };\n        }\n    }\n\n    function readImageData(element) {\n        var relationshipId = element.attributes['r:id'];\n\n        if (relationshipId) {\n            return readImage(\n                findEmbeddedImageFile(relationshipId),\n                element.attributes[\"o:title\"]);\n        } else {\n            return emptyResultWithMessages([warning(\"A v:imagedata element without a relationship ID was ignored\")]);\n        }\n    }\n\n    function findEmbeddedImageFile(relationshipId) {\n        var path = uris.uriToZipEntryName(\"word\", relationships.findTargetByRelationshipId(relationshipId));\n        return {\n            path: path,\n            read: docxFile.read.bind(docxFile, path)\n        };\n    }\n\n    function readImage(imageFile, altText) {\n        var contentType = contentTypes.findContentType(imageFile.path);\n\n        var image = documents.Image({\n            readImage: imageFile.read,\n            altText: altText,\n            contentType: contentType\n        });\n        var warnings = supportedImageTypes[contentType] ?\n            [] : warning(\"Image of type \" + contentType + \" is unlikely to display in web browsers\");\n        return elementResultWithMessages(image, warnings);\n    }\n\n    function undefinedStyleWarning(type, styleId) {\n        return warning(\n            type + \" style with ID \" + styleId + \" was referenced but not defined in the document\");\n    }\n}\n\n\nfunction readNumberingProperties(styleId, element, numbering) {\n    if (styleId != null) {\n        var levelByStyleId = numbering.findLevelByParagraphStyleId(styleId);\n        if (levelByStyleId != null) {\n            return levelByStyleId;\n        }\n    }\n\n    var level = element.firstOrEmpty(\"w:ilvl\").attributes[\"w:val\"];\n    var numId = element.firstOrEmpty(\"w:numId\").attributes[\"w:val\"];\n    if (level === undefined || numId === undefined) {\n        return null;\n    } else {\n        return numbering.findLevel(numId, level);\n    }\n}\n\nvar supportedImageTypes = {\n    \"image/png\": true,\n    \"image/gif\": true,\n    \"image/jpeg\": true,\n    \"image/svg+xml\": true,\n    \"image/tiff\": true\n};\n\nvar ignoreElements = {\n    \"office-word:wrap\": true,\n    \"v:shadow\": true,\n    \"v:shapetype\": true,\n    \"w:annotationRef\": true,\n    \"w:bookmarkEnd\": true,\n    \"w:sectPr\": true,\n    \"w:proofErr\": true,\n    \"w:lastRenderedPageBreak\": true,\n    \"w:commentRangeStart\": true,\n    \"w:commentRangeEnd\": true,\n    \"w:del\": true,\n    \"w:footnoteRef\": true,\n    \"w:endnoteRef\": true,\n    \"w:tblPr\": true,\n    \"w:tblGrid\": true,\n    \"w:trPr\": true,\n    \"w:tcPr\": true\n};\n\nfunction isParagraphProperties(element) {\n    return element.type === \"paragraphProperties\";\n}\n\nfunction isRunProperties(element) {\n    return element.type === \"runProperties\";\n}\n\nfunction negate(predicate) {\n    return function(value) {\n        return !predicate(value);\n    };\n}\n\n\nfunction emptyResultWithMessages(messages) {\n    return new ReadResult(null, null, messages);\n}\n\nfunction emptyResult() {\n    return new ReadResult(null);\n}\n\nfunction elementResult(element) {\n    return new ReadResult(element);\n}\n\nfunction elementResultWithMessages(element, messages) {\n    return new ReadResult(element, null, messages);\n}\n\nfunction ReadResult(element, extra, messages) {\n    this.value = element || [];\n    this.extra = extra;\n    this._result = new Result({\n        element: this.value,\n        extra: extra\n    }, messages);\n    this.messages = this._result.messages;\n}\n\nReadResult.prototype.toExtra = function() {\n    return new ReadResult(null, joinElements(this.extra, this.value), this.messages);\n};\n\nReadResult.prototype.insertExtra = function() {\n    var extra = this.extra;\n    if (extra && extra.length) {\n        return new ReadResult(joinElements(this.value, extra), null, this.messages);\n    } else {\n        return this;\n    }\n};\n\nReadResult.prototype.map = function(func) {\n    var result = this._result.map(function(value) {\n        return func(value.element);\n    });\n    return new ReadResult(result.value, this.extra, result.messages);\n};\n\nReadResult.prototype.flatMap = function(func) {\n    var result = this._result.flatMap(function(value) {\n        return func(value.element)._result;\n    });\n    return new ReadResult(result.value.element, joinElements(this.extra, result.value.extra), result.messages);\n};\n\nfunction combineResults(results) {\n    var result = Result.combine(_.pluck(results, \"_result\"));\n    return new ReadResult(\n        _.flatten(_.pluck(result.value, \"element\")),\n        _.filter(_.flatten(_.pluck(result.value, \"extra\")), identity),\n        result.messages\n    );\n}\n\nfunction joinElements(first, second) {\n    return _.flatten([first, second]);\n}\n\nfunction identity(value) {\n    return value;\n}\n"]},"metadata":{},"sourceType":"script"}