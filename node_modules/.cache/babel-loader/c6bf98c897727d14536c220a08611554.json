{"ast":null,"code":"\"use strict\";\n\nmodule.exports = function (Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug) {\n  var getDomain = Promise._getDomain;\n\n  var util = require(\"./util\");\n\n  var tryCatch = util.tryCatch;\n\n  function ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var domain = getDomain();\n    this._fn = domain === null ? fn : util.domainBind(domain, fn);\n\n    if (initialValue !== undefined) {\n      initialValue = Promise.resolve(initialValue);\n\n      initialValue._attachCancellationCallback(this);\n    }\n\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n\n    if (_each === INTERNAL) {\n      this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n      this._eachValues = null;\n    } else {\n      this._eachValues = undefined;\n    }\n\n    this._promise._captureStackTrace();\n\n    this._init$(undefined, -5);\n  }\n\n  util.inherits(ReductionPromiseArray, PromiseArray);\n\n  ReductionPromiseArray.prototype._gotAccum = function (accum) {\n    if (this._eachValues !== undefined && this._eachValues !== null && accum !== INTERNAL) {\n      this._eachValues.push(accum);\n    }\n  };\n\n  ReductionPromiseArray.prototype._eachComplete = function (value) {\n    if (this._eachValues !== null) {\n      this._eachValues.push(value);\n    }\n\n    return this._eachValues;\n  };\n\n  ReductionPromiseArray.prototype._init = function () {};\n\n  ReductionPromiseArray.prototype._resolveEmptyArray = function () {\n    this._resolve(this._eachValues !== undefined ? this._eachValues : this._initialValue);\n  };\n\n  ReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n  };\n\n  ReductionPromiseArray.prototype._resolve = function (value) {\n    this._promise._resolveCallback(value);\n\n    this._values = null;\n  };\n\n  ReductionPromiseArray.prototype._resultCancelled = function (sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n\n    this._resultCancelled$();\n\n    if (this._currentCancellable instanceof Promise) {\n      this._currentCancellable.cancel();\n    }\n\n    if (this._initialValue instanceof Promise) {\n      this._initialValue.cancel();\n    }\n  };\n\n  ReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n\n    if (this._initialValue !== undefined) {\n      value = this._initialValue;\n      i = 0;\n    } else {\n      value = Promise.resolve(values[0]);\n      i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    if (!value.isRejected()) {\n      for (; i < length; ++i) {\n        var ctx = {\n          accum: null,\n          value: values[i],\n          index: i,\n          length: length,\n          array: this\n        };\n        value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n      }\n    }\n\n    if (this._eachValues !== undefined) {\n      value = value._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n\n    value._then(completed, completed, undefined, value, this);\n  };\n\n  Promise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n  };\n\n  Promise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n  };\n\n  function completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n      array._resolve(valueOrReason);\n    } else {\n      array._reject(valueOrReason);\n    }\n  }\n\n  function reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n      return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n  }\n\n  function gotAccum(accum) {\n    this.accum = accum;\n\n    this.array._gotAccum(accum);\n\n    var value = tryConvertToPromise(this.value, this.array._promise);\n\n    if (value instanceof Promise) {\n      this.array._currentCancellable = value;\n      return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n      return gotValue.call(this, value);\n    }\n  }\n\n  function gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n\n    promise._pushContext();\n\n    var ret;\n\n    if (array._eachValues !== undefined) {\n      ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n      ret = fn.call(promise._boundValue(), this.accum, value, this.index, this.length);\n    }\n\n    if (ret instanceof Promise) {\n      array._currentCancellable = ret;\n    }\n\n    var promiseCreated = promise._popContext();\n\n    debug.checkForgottenReturns(ret, promiseCreated, array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\", promise);\n    return ret;\n  }\n};","map":{"version":3,"sources":["C:/Users/Carlos/Desktop/Coding/doc-to-html/node_modules/bluebird/js/release/reduce.js"],"names":["module","exports","Promise","PromiseArray","apiRejection","tryConvertToPromise","INTERNAL","debug","getDomain","_getDomain","util","require","tryCatch","ReductionPromiseArray","promises","fn","initialValue","_each","constructor$","domain","_fn","domainBind","undefined","resolve","_attachCancellationCallback","_initialValue","_currentCancellable","_eachValues","Array","_length","_promise","_captureStackTrace","_init$","inherits","prototype","_gotAccum","accum","push","_eachComplete","value","_init","_resolveEmptyArray","_resolve","shouldCopyValues","_resolveCallback","_values","_resultCancelled","sender","_cancel","_isResolved","_resultCancelled$","cancel","_iterate","values","i","length","isRejected","ctx","index","array","_then","gotAccum","completed","reduce","valueOrReason","isFulfilled","_reject","classString","promise","gotValue","call","_pushContext","ret","_boundValue","promiseCreated","_popContext","checkForgottenReturns"],"mappings":"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","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var domain = getDomain();\n    this._fn = domain === null ? fn : util.domainBind(domain, fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    if(_each === INTERNAL) {\n        this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n        this._eachValues = null;\n    } else {\n        this._eachValues = undefined;\n    }\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined && \n        this._eachValues !== null && \n        accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    if (this._eachValues !== null) {\n        this._eachValues.push(value);\n    }\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n"]},"metadata":{},"sourceType":"script"}